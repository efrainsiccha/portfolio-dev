---
const { name, description, url, image, tags, details } = Astro.props;
const modalId = `modal-${name.replace(/[^a-zA-Z0-9]/g, '-')}`;
const isModal = !url && !!details;
const href = url || "#";
---

<>
  <a
    href={href}
    target={isModal || url === "#" ? "_self" : "_blank"}
    onclick={(isModal || url === "#") ? `event.preventDefault(); document.getElementById('${modalId}').showModal();` : ""}
    class="relative flex flex-col items-stretch duration-300 ease-out p-7 sm:p-3 group h-100 rounded-2xl cursor-pointer"
  >
    <span
      class="absolute inset-0 z-20 block w-full h-full duration-300 ease-out bg-transparent border border-transparent border-dashed group-hover:-translate-x-1 group-hover:-translate-y-1 group-hover:border group-hover:border-neutral-300 dark:group-hover:border-neutral-600 group-hover:border-dashed rounded-2xl group-hover:bg-white dark:group-hover:bg-neutral-950"
    ></span>
    <span
      class="absolute inset-0 z-10 block w-full h-full duration-300 ease-out border border-dashed rounded-2xl border-neutral-300 dark:border-neutral-600 group-hover:translate-x-1 group-hover:translate-y-1"
    ></span>
    <span
      class="relative z-30 block duration-300 ease-out group-hover:-translate-x-1 group-hover:-translate-y-1"
    >
      <span class="block w-full">
        {image ? (
          <img src={image} class="w-full h-auto rounded-lg aspect-[16/9] object-cover" />
        ) : (
          <div class="w-full h-auto rounded-lg aspect-[16/9] bg-neutral-100 dark:bg-neutral-800 flex items-center justify-center text-neutral-400">
            <svg class="w-10 h-10 opacity-50" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path></svg>
          </div>
        )}
      </span>
      <span class="block w-full px-1 mt-5 mb-1 sm:mt-3">
        <span
          class="flex items-center mb-0 text-base font-semibold tracking-tight text-neutral-900 dark:text-neutral-100"
        >
          <span>{name}</span>
          <svg
            class="group-hover:translate-x-0 group-hover:translate-y-0 -rotate-45 translate-y-1 -translate-x-1 w-2.5 h-2.5 stroke-current ml-1 transition-all ease-in-out duration-200 transform"
            viewBox="0 0 13 15"
            version="1.1"
            xmlns="http://www.w3.org/2000/svg"
            xmlns:xlink="http://www.w3.org/1999/xlink"
            ><g
              stroke="none"
              stroke-width="1"
              fill="none"
              fill-rule="evenodd"
              stroke-linecap="round"
              stroke-linejoin="round"
              ><g
                id="svg"
                transform="translate(0.666667, 2.333333)"
                stroke="currentColor"
                stroke-width="2.4"
                ><g
                  ><polyline
                    class="transition-all duration-200 ease-out opacity-0 delay-0 group-hover:opacity-100"
                    points="5.33333333 0 10.8333333 5.5 5.33333333 11"
                  ></polyline><line
                    class="transition-all duration-200 ease-out transform -translate-x-1 opacity-0 group-hover:translate-x-0 group-hover:opacity-100 group-hover:ml-0"
                    x1="10.8333333"
                    y1="5.5"
                    x2="0.833333333"
                    y2="5.16666667"></line></g
                ></g
              ></g
            ></svg
          >
        </span>
        <span class="text-sm text-neutral-600 dark:text-neutral-400 block truncate"
          >{description}</span
        >
        {tags && (
          <div class="flex flex-wrap gap-2 mt-2">
            {tags.map((tag) => (
              <span class="text-xs bg-neutral-200 dark:bg-neutral-800 px-2 py-1 rounded-md text-neutral-600 dark:text-neutral-400">{tag}</span>
            ))}
          </div>
        )}
      </span>
    </span>
  </a>

  {details && (
    <dialog id={modalId} class="p-0 rounded-xl backdrop:bg-black/50 w-full max-w-2xl dark:bg-neutral-900 dark:text-white border border-neutral-200 dark:border-neutral-800 shadow-2xl">
      <div class="p-6">
        <div class="flex justify-between items-center mb-4">
          <h3 class="text-2xl font-bold pr-8">{name}</h3>
          <button onclick={`this.closest('dialog').close()`} class="text-neutral-500 hover:text-neutral-900 dark:hover:text-white absolute top-6 right-6">
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
          </button>
        </div>
        {image && <img src={image} class="w-full h-auto max-h-80 object-cover rounded-lg mb-6" />}
        <div class="prose dark:prose-invert max-w-none text-sm sm:text-base text-neutral-600 dark:text-neutral-300" set:html={details}></div>
        
        {tags && (
          <div class="flex flex-wrap gap-2 mt-6 pt-6 border-t border-neutral-200 dark:border-neutral-800">
            {tags.map((tag) => (
              <span class="text-xs bg-neutral-100 dark:bg-neutral-800 px-2.5 py-1 rounded-full border border-neutral-200 dark:border-neutral-700 text-neutral-600 dark:text-neutral-400">{tag}</span>
            ))}
          </div>
        )}
      </div>
      <form method="dialog" class="modal-backdrop">
        <button class="fixed inset-0 w-full h-full cursor-default -z-10" style="background: transparent; border: none;"></button>
      </form>
    </dialog>
  )}
</>
